<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GhostReply Analytics</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: #111;
            border-bottom: 1px solid #222;
            padding: 20px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header h1 { font-size: 22px; font-weight: 700; }
        .header h1 span { color: #4ade80; }
        .header .meta { color: #666; font-size: 13px; }

        .container { max-width: 1200px; margin: 0 auto; padding: 32px 24px; }

        /* Stat cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        .stat-card {
            background: #151515;
            border: 1px solid #252525;
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
        }
        .stat-card.green::before { background: #4ade80; }
        .stat-card.blue::before { background: #60a5fa; }
        .stat-card.purple::before { background: #a78bfa; }
        .stat-card.orange::before { background: #fb923c; }
        .stat-card.pink::before { background: #f472b6; }
        .stat-card.yellow::before { background: #fbbf24; }

        .stat-label { font-size: 13px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .stat-value { font-size: 36px; font-weight: 700; letter-spacing: -1px; }
        .stat-sub { font-size: 12px; color: #666; margin-top: 4px; }
        .stat-value.loading { color: #333; }

        /* Sections */
        .section {
            background: #151515;
            border: 1px solid #252525;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .section h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ccc;
        }

        /* Table */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; padding: 8px 12px; border-bottom: 1px solid #252525; }
        td { padding: 10px 12px; border-bottom: 1px solid #1a1a1a; font-size: 14px; color: #ccc; }
        tr:hover td { background: #1a1a1a; }

        /* Directory list */
        .dir-list { list-style: none; }
        .dir-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #1a1a1a;
        }
        .dir-item:last-child { border-bottom: none; }
        .dir-name { font-size: 14px; }
        .dir-status {
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 500;
        }
        .dir-status.live { background: #052e16; color: #4ade80; }
        .dir-status.pending { background: #1c1917; color: #fbbf24; }
        .dir-status.submitted { background: #0c1a3d; color: #60a5fa; }

        /* Chart area */
        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
            padding: 16px 0;
        }
        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, #4ade80 0%, #166534 100%);
            border-radius: 4px 4px 0 0;
            min-height: 2px;
            position: relative;
            transition: height 0.3s ease;
        }
        .chart-bar:hover { opacity: 0.8; }
        .chart-bar .tooltip {
            display: none;
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
        }
        .chart-bar:hover .tooltip { display: block; }
        .chart-labels {
            display: flex;
            gap: 4px;
        }
        .chart-labels span {
            flex: 1;
            text-align: center;
            font-size: 10px;
            color: #444;
        }

        /* Refresh */
        .refresh-btn {
            background: #222;
            border: 1px solid #333;
            color: #888;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
        }
        .refresh-btn:hover { background: #2a2a2a; color: #ccc; }

        /* Two col */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        @media (max-width: 768px) {
            .two-col { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* Event log */
        .event-log { max-height: 300px; overflow-y: auto; }
        .event-item {
            display: flex;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #1a1a1a;
            font-size: 13px;
        }
        .event-time { color: #555; font-family: 'SF Mono', monospace; font-size: 12px; min-width: 80px; }
        .event-type {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 500;
            min-width: 70px;
            text-align: center;
        }
        .event-type.install { background: #052e16; color: #4ade80; }
        .event-type.visit { background: #0c1a3d; color: #60a5fa; }
        .event-type.run { background: #1a0a2e; color: #a78bfa; }
        .event-msg { color: #888; }

        .password-gate {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .password-box {
            text-align: center;
        }
        .password-box h2 { margin-bottom: 16px; font-size: 20px; }
        .password-box input {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            width: 280px;
            text-align: center;
            outline: none;
        }
        .password-box input:focus { border-color: #4ade80; }
        .password-box .error { color: #ff4444; font-size: 13px; margin-top: 8px; display: none; }
    </style>
</head>
<body>
    <!-- Password gate -->
    <div class="password-gate" id="gate">
        <div class="password-box">
            <div style="font-size:48px; margin-bottom:16px;">ðŸ‘»ðŸ“Š</div>
            <h2>GhostReply Analytics</h2>
            <input type="password" id="pw" placeholder="Password" autofocus>
            <div class="error" id="pw-error">Wrong password</div>
        </div>
    </div>

    <div id="dashboard" style="display:none;">
        <div class="header">
            <div>
                <h1>ðŸ‘» Ghost<span>Reply</span> Analytics</h1>
            </div>
            <div style="display:flex; align-items:center; gap:12px;">
                <span class="meta" id="last-updated">Loading...</span>
                <button class="refresh-btn" onclick="loadAll()">Refresh</button>
            </div>
        </div>

        <div class="container">
            <!-- Top stats -->
            <div class="stats-grid">
                <div class="stat-card green">
                    <div class="stat-label">Total Installs</div>
                    <div class="stat-value loading" id="stat-installs">â€”</div>
                    <div class="stat-sub">via curl install.sh</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-label">Site Visits (14d)</div>
                    <div class="stat-value loading" id="stat-views">â€”</div>
                    <div class="stat-sub">GitHub Pages traffic</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-label">Unique Visitors (14d)</div>
                    <div class="stat-value loading" id="stat-uniques">â€”</div>
                    <div class="stat-sub">GitHub Pages traffic</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-label">GitHub Stars</div>
                    <div class="stat-value loading" id="stat-stars">â€”</div>
                    <div class="stat-sub">Hrampell/ghostreply</div>
                </div>
                <div class="stat-card pink">
                    <div class="stat-label">Repo Clones (14d)</div>
                    <div class="stat-value loading" id="stat-clones">â€”</div>
                    <div class="stat-sub">git clone count</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-label">PH Upvotes</div>
                    <div class="stat-value loading" id="stat-ph">â€”</div>
                    <div class="stat-sub">Product Hunt launch</div>
                </div>
            </div>

            <div class="two-col">
                <!-- Install tracking chart -->
                <div class="section">
                    <h2>Installs (Last 14 Days)</h2>
                    <div class="chart-container" id="install-chart">
                        <div style="color:#444; font-size:13px; margin:auto;">Loading...</div>
                    </div>
                    <div class="chart-labels" id="install-labels"></div>
                </div>

                <!-- Page views chart -->
                <div class="section">
                    <h2>Page Views (Last 14 Days)</h2>
                    <div class="chart-container" id="views-chart">
                        <div style="color:#444; font-size:13px; margin:auto;">Loading...</div>
                    </div>
                    <div class="chart-labels" id="views-labels"></div>
                </div>
            </div>

            <div class="two-col">
                <!-- Directory listings -->
                <div class="section">
                    <h2>Directory Listings</h2>
                    <ul class="dir-list">
                        <li class="dir-item">
                            <span class="dir-name">Product Hunt</span>
                            <span class="dir-status live">Live</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">Hacker News (Show HN)</span>
                            <span class="dir-status live">Live</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">DevHunt</span>
                            <span class="dir-status live">Live</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">SaaSHub</span>
                            <span class="dir-status submitted">Submitted</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">FutureTools.io</span>
                            <span class="dir-status submitted">Submitted</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">AI Tools Directory</span>
                            <span class="dir-status submitted">Submitted</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">aitoolslist.io</span>
                            <span class="dir-status submitted">Submitted</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">MarsX</span>
                            <span class="dir-status pending">Pending</span>
                        </li>
                        <li class="dir-item">
                            <span class="dir-name">Launching Next</span>
                            <span class="dir-status submitted">Submitted</span>
                        </li>
                    </ul>
                </div>

                <!-- Referral sources -->
                <div class="section">
                    <h2>Top Referrers (14d)</h2>
                    <table>
                        <thead><tr><th>Source</th><th>Visits</th></tr></thead>
                        <tbody id="referrer-table">
                            <tr><td colspan="2" style="color:#444;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="two-col">
                <!-- Popular pages -->
                <div class="section">
                    <h2>Popular Pages (14d)</h2>
                    <table>
                        <thead><tr><th>Path</th><th>Views</th><th>Uniques</th></tr></thead>
                        <tbody id="pages-table">
                            <tr><td colspan="3" style="color:#444;">Loading...</td></tr>
                        </tbody>
                    </table>
                    <p style="color:#555; font-size:12px; margin-top:12px;">
                        <code>/install.sh</code> hits = download command runs &nbsp;|&nbsp;
                        <code>/ping</code> hits = completed installs
                    </p>
                </div>

                <!-- Manual stats -->
                <div class="section">
                    <h2>Manual Counters</h2>
                    <p style="color:#666; font-size:13px; margin-bottom:12px;">Update stats that can't be auto-fetched:</p>
                    <div style="display:flex; flex-direction:column; gap:10px;">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <label style="color:#888; font-size:13px; min-width:100px;">PH Upvotes:</label>
                            <input type="number" id="manual-ph" placeholder="0" style="background:#1a1a1a; border:1px solid #333; color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; width:100px;">
                        </div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <label style="color:#888; font-size:13px; min-width:100px;">Total Installs:</label>
                            <input type="number" id="manual-installs" placeholder="0" style="background:#1a1a1a; border:1px solid #333; color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; width:100px;">
                        </div>
                        <button class="refresh-btn" style="width:fit-content;" onclick="saveManual()">Save</button>
                    </div>
                </div>
            </div>

            <!-- Setup -->
            <div class="section">
                <h2>Tracking Setup</h2>
                <p style="color:#888; font-size:14px; line-height:1.8;">
                    <strong style="color:#ccc;">Install tracking:</strong> Each run of <code style="background:#222; padding:2px 6px; border-radius:4px; font-size:12px; color:#4ade80;">curl -sL ghostreply.lol/install.sh | bash</code> also pings <code style="background:#222; padding:2px 6px; border-radius:4px; font-size:12px;">/ping?e=install</code> â€” counted via GitHub Pages traffic as <code>/ping</code> hits.<br>
                    <strong style="color:#ccc;">Page views:</strong> GitHub Pages traffic API (views to <code>/</code> and <code>/index.html</code>).<br>
                    <strong style="color:#ccc;">Stars/clones:</strong> GitHub REST API (public, no token needed).<br>
                    <strong style="color:#ccc;">Referrers &amp; pages:</strong> GitHub traffic popular paths/referrers API (requires token with repo scope).<br>
                </p>
                <div style="margin-top:16px;">
                    <label style="color:#888; font-size:13px;">GitHub Token (for traffic data â€” needs <code style="font-size:11px;">repo</code> scope):</label><br>
                    <input type="password" id="gh-token" placeholder="ghp_..." style="background:#1a1a1a; border:1px solid #333; color:#fff; padding:8px 12px; border-radius:6px; font-size:13px; width:360px; margin-top:4px; font-family:monospace;">
                    <button class="refresh-btn" style="margin-left:8px;" onclick="saveToken()">Save & Reload</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    const REPO = 'Hrampell/ghostreply';
    const PW_HASH = '5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8'; // sha256 of 'password' â€” change this
    const COUNTER_NS = 'ghostreply';

    // Simple password check (client-side, just to keep casual visitors out)
    document.getElementById('pw').addEventListener('keydown', async function(e) {
        if (e.key !== 'Enter') return;
        const pw = this.value;
        const hash = await sha256(pw);
        // Accept "rampell" as password
        if (hash === '31998ec8d822f59fe4277dd9d5cb7f9cd357450199e5ba24a556c360859c0dc5') {
            document.getElementById('gate').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            localStorage.setItem('gr_analytics_pw', pw);
            loadAll();
        } else {
            document.getElementById('pw-error').style.display = 'block';
            this.style.borderColor = '#ff4444';
            setTimeout(() => {
                document.getElementById('pw-error').style.display = 'none';
                this.style.borderColor = '#333';
            }, 2000);
        }
    });

    // Auto-login if saved
    (async () => {
        const saved = localStorage.getItem('gr_analytics_pw');
        if (saved) {
            const hash = await sha256(saved);
            if (hash === '31998ec8d822f59fe4277dd9d5cb7f9cd357450199e5ba24a556c360859c0dc5') {
                document.getElementById('gate').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadAll();
            }
        }
    })();

    async function sha256(str) {
        const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
        return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function getToken() {
        return localStorage.getItem('gr_gh_token') || '';
    }

    function saveToken() {
        const token = document.getElementById('gh-token').value.trim();
        if (token) localStorage.setItem('gr_gh_token', token);
        loadAll();
    }

    async function loadAll() {
        document.getElementById('last-updated').textContent = 'Refreshing...';
        loadManualInputs();
        await Promise.allSettled([
            loadGitHubStats(),
            loadInstallCount(),
            loadGitHubTraffic(),
        ]);
        document.getElementById('last-updated').textContent = 'Updated ' + new Date().toLocaleTimeString();
    }

    // --- GitHub public stats ---
    async function loadGitHubStats() {
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}`);
            const data = await res.json();
            setText('stat-stars', data.stargazers_count ?? '?');
        } catch (e) {
            setText('stat-stars', 'err');
        }
    }

    // --- Install count ---
    async function loadInstallCount() {
        // From localStorage manual counter, or will be overridden by GitHub traffic /ping hits
        const count = localStorage.getItem('gr_install_count') || '0';
        setText('stat-installs', count);
        renderInstallChart([]);
    }

    // --- GitHub traffic (requires token) ---
    async function loadGitHubTraffic() {
        const token = getToken();
        if (!token) {
            setText('stat-views', 'â€”');
            setText('stat-uniques', 'â€”');
            setText('stat-clones', 'â€”');
            document.getElementById('views-chart').innerHTML = '<div style="color:#444; font-size:13px; margin:auto;">Add GitHub token for traffic data</div>';
            document.getElementById('referrer-table').innerHTML = '<tr><td colspan="2" style="color:#444;">Add GitHub token above</td></tr>';
            return;
        }

        const headers = { 'Authorization': `token ${token}` };

        try {
            // Page views
            const viewsRes = await fetch(`https://api.github.com/repos/${REPO}/traffic/views`, { headers });
            const views = await viewsRes.json();
            setText('stat-views', views.count ?? '?');
            setText('stat-uniques', views.uniques ?? '?');
            if (views.views) renderViewsChart(views.views);

            // Clones
            const clonesRes = await fetch(`https://api.github.com/repos/${REPO}/traffic/clones`, { headers });
            const clones = await clonesRes.json();
            setText('stat-clones', clones.count ?? '?');

            // Referrers
            const refRes = await fetch(`https://api.github.com/repos/${REPO}/traffic/popular/referrers`, { headers });
            const refs = await refRes.json();
            renderReferrers(refs);

            // Popular paths
            const pathsRes = await fetch(`https://api.github.com/repos/${REPO}/traffic/popular/paths`, { headers });
            const paths = await pathsRes.json();
            renderPaths(paths);

            // Extract install count from /ping or /install.sh hits
            if (Array.isArray(paths)) {
                const pingHits = paths.find(p => p.path.includes('/ping'));
                const installHits = paths.find(p => p.path.includes('/install.sh'));
                if (pingHits) setText('stat-installs', pingHits.count);
                else if (installHits) setText('stat-installs', installHits.count);
            }
        } catch(e) {
            console.error('Traffic error:', e);
        }
    }


    // --- Render helpers ---
    function setText(id, val) {
        const el = document.getElementById(id);
        el.textContent = typeof val === 'number' ? val.toLocaleString() : val;
        el.classList.remove('loading');
    }

    function renderViewsChart(data) {
        const el = document.getElementById('views-chart');
        const labels = document.getElementById('views-labels');
        if (!data || data.length === 0) {
            el.innerHTML = '<div style="color:#444; font-size:13px; margin:auto;">No data yet</div>';
            return;
        }
        const max = Math.max(...data.map(d => d.count), 1);
        el.innerHTML = data.map(d => {
            const h = (d.count / max) * 180;
            const date = new Date(d.timestamp).toLocaleDateString('en-US', { month:'short', day:'numeric' });
            return `<div class="chart-bar" style="height:${Math.max(h, 2)}px; background: linear-gradient(180deg, #60a5fa 0%, #1e40af 100%);"><div class="tooltip">${date}: ${d.count}</div></div>`;
        }).join('');
        labels.innerHTML = data.map(d => {
            const date = new Date(d.timestamp).toLocaleDateString('en-US', { day:'numeric' });
            return `<span>${date}</span>`;
        }).join('');
    }

    function renderInstallChart(data) {
        const el = document.getElementById('install-chart');
        const labels = document.getElementById('install-labels');
        if (!data || data.length === 0) {
            el.innerHTML = '<div style="color:#444; font-size:13px; margin:auto;">Install tracking active â€” data will appear here</div>';
            return;
        }
        const max = Math.max(...data.map(d => d.count), 1);
        el.innerHTML = data.map(d => {
            const h = (d.count / max) * 180;
            return `<div class="chart-bar" style="height:${Math.max(h, 2)}px;"><div class="tooltip">${d.date}: ${d.count}</div></div>`;
        }).join('');
        labels.innerHTML = data.map(d => `<span>${d.date.split('-').pop()}</span>`).join('');
    }

    function renderReferrers(data) {
        const el = document.getElementById('referrer-table');
        if (!data || data.length === 0) {
            el.innerHTML = '<tr><td colspan="2" style="color:#444;">No referrer data</td></tr>';
            return;
        }
        el.innerHTML = data.map(r => `
            <tr>
                <td>${r.referrer}</td>
                <td style="color:#4ade80; font-weight:600;">${r.count}</td>
            </tr>
        `).join('');
    }

    function renderPaths(data) {
        const el = document.getElementById('pages-table');
        if (!data || !Array.isArray(data) || data.length === 0) {
            el.innerHTML = '<tr><td colspan="3" style="color:#444;">No path data</td></tr>';
            return;
        }
        el.innerHTML = data.map(p => `
            <tr>
                <td><code style="background:#222; padding:2px 6px; border-radius:4px; font-size:12px;">${p.path}</code></td>
                <td style="color:#4ade80; font-weight:600;">${p.count}</td>
                <td style="color:#888;">${p.uniques}</td>
            </tr>
        `).join('');
    }

    // --- Manual counters ---
    function saveManual() {
        const ph = document.getElementById('manual-ph').value;
        const installs = document.getElementById('manual-installs').value;
        if (ph) { localStorage.setItem('gr_ph_upvotes', ph); setText('stat-ph', ph); }
        if (installs) { localStorage.setItem('gr_install_count', installs); setText('stat-installs', installs); }
    }

    function loadManualInputs() {
        const ph = localStorage.getItem('gr_ph_upvotes');
        const installs = localStorage.getItem('gr_install_count');
        if (ph) { document.getElementById('manual-ph').value = ph; setText('stat-ph', ph); }
        if (installs) { document.getElementById('manual-installs').value = installs; setText('stat-installs', installs); }
    }

    // Pre-fill GH token if saved
    const savedToken = getToken();
    if (savedToken) document.getElementById('gh-token').value = savedToken;
    </script>
</body>
</html>
